// JayData 1.2.7.1 WebSQL Provider Pro - Trial License
// Copyright JayStack Technologies (http://jaydata.org/licensing)
// Support: http://jaystack.com
$data.Class.define("$data.storageProviders.sqLitePro.SqLiteStorageProvider",$data.StorageProviderBase,null,{constructor:function(a,b){this.SqlCommands=[];this.context=b;this.providerConfiguration=$data.typeSystem.extend({databaseName:"JayDataDemo",version:"",displayName:"JayData demo db",maxSize:1048576,dbCreation:$data.storageProviders.DbCreationType.DropTableIfChanged},a);this.providerName="";for(var d in $data.RegisteredStorageProviders)$data.RegisteredStorageProviders[d]===this.getType()&&(this.providerName=
d);this.context&&this.context._buildDbType_generateConvertToFunction&&this.buildDbType_generateConvertToFunction&&(this.context._buildDbType_generateConvertToFunction=this.buildDbType_generateConvertToFunction);this.context&&this.context._buildDbType_modifyInstanceDefinition&&this.buildDbType_modifyInstanceDefinition&&(this.context._buildDbType_modifyInstanceDefinition=this.buildDbType_modifyInstanceDefinition)},_createSqlConnection:function(){var a={fileName:this.providerConfiguration.databaseName,
version:"",displayName:this.providerConfiguration.displayName,maxSize:this.providerConfiguration.maxSize,storage:this.providerConfiguration.storage};if(this.connection)return this.connection;var b=null;return this.connection=b=this.providerConfiguration.storage?new $data.dbClient.jayStorageClient.JayStorageConnection(a):"undefined"!==typeof sqLiteModule?new $data.dbClient.sqLiteNJClient.SqLiteNjConnection(a):new $data.dbClient.openDatabaseClient.OpenDbConnection(a)},supportedDataTypes:{value:[$data.Array,
$data.Integer,$data.String,$data.Number,$data.Blob,$data.Boolean,$data.Date,$data.Guid,$data.GeographyPoint,$data.GeographyLineString,$data.GeographyPolygon,$data.GeographyMultiPoint,$data.GeographyMultiLineString,$data.GeographyMultiPolygon,$data.GeographyCollection,$data.GeometryPoint,$data.GeometryLineString,$data.GeometryPolygon,$data.GeometryMultiPoint,$data.GeometryMultiLineString,$data.GeometryMultiPolygon,$data.GeometryCollection],writable:!1},fieldConverter:{value:{fromDb:{"$data.Integer":function(a){return a},
"$data.Number":function(a){return a},"$data.Date":function(a){return null!=a?new Date(a):a},"$data.String":function(a){return a},"$data.Boolean":function(a){return 1===a?!0:!1},"$data.Blob":function(a){return a},"$data.Array":function(){return 0==arguments.length?[]:arguments[0]?JSON.parse(arguments[0]):void 0},"$data.Guid":function(a){return a?$data.parseGuid(a):a},"$data.GeographyPoint":function(a){return a?new $data.GeographyPoint(JSON.parse(a)):a},"$data.GeographyLineString":function(a){return a?
new $data.GeographyLineString(JSON.parse(a)):a},"$data.GeographyPolygon":function(a){return a?new $data.GeographyPolygon(JSON.parse(a)):a},"$data.GeographyMultiPoint":function(a){return a?new $data.GeographyMultiPoint(JSON.parse(a)):a},"$data.GeographyMultiLineString":function(a){return a?new $data.GeographyMultiLineString(JSON.parse(a)):a},"$data.GeographyMultiPolygon":function(a){return a?new $data.GeographyMultiPolygon(JSON.parse(a)):a},"$data.GeographyCollection":function(a){return a?new $data.GeographyCollection(JSON.parse(a)):
a},"$data.GeometryPoint":function(a){return a?new $data.GeometryPoint(JSON.parse(a)):a},"$data.GeometryLineString":function(a){return a?new $data.GeometryLineString(JSON.parse(a)):a},"$data.GeometryPolygon":function(a){return a?new $data.GeometryPolygon(JSON.parse(a)):a},"$data.GeometryMultiPoint":function(a){return a?new $data.GeometryMultiPoint(JSON.parse(a)):a},"$data.GeometryMultiLineString":function(a){return a?new $data.GeometryMultiLineString(JSON.parse(a)):a},"$data.GeometryMultiPolygon":function(a){return a?
new $data.GeometryMultiPolygon(JSON.parse(a)):a},"$data.GeometryCollection":function(a){return a?new $data.GeometryCollection(JSON.parse(a)):a}},toDb:{"$data.Integer":function(a){return a},"$data.Number":function(a){return a},"$data.Date":function(a){return a?a.valueOf():null},"$data.String":function(a){return a},"$data.Boolean":function(a){return a?1:0},"$data.Blob":function(a){return a},"$data.Array":function(a){return a?JSON.stringify(a):a},"$data.Guid":function(a){return a?a.value:a},"$data.Object":function(a){if(null===
a)return null;throw"Not supported exception";},"$data.GeographyPoint":function(a){return a?JSON.stringify(a):a},"$data.GeographyLineString":function(a){return a?JSON.stringify(a):a},"$data.GeographyPolygon":function(a){return a?JSON.stringify(a):a},"$data.GeographyMultiPoint":function(a){return a?JSON.stringify(a):a},"$data.GeographyMultiLineString":function(a){return a?JSON.stringify(a):a},"$data.GeographyMultiPolygon":function(a){return a?JSON.stringify(a):a},"$data.GeographyCollection":function(a){return a?
JSON.stringify(a):a},"$data.GeometryPoint":function(a){return a?JSON.stringify(a):a},"$data.GeometryLineString":function(a){return a?JSON.stringify(a):a},"$data.GeometryPolygon":function(a){return a?JSON.stringify(a):a},"$data.GeometryMultiPoint":function(a){return a?JSON.stringify(a):a},"$data.GeometryMultiLineString":function(a){return a?JSON.stringify(a):a},"$data.GeometryMultiPolygon":function(a){return a?JSON.stringify(a):a},"$data.GeometryCollection":function(a){return a?JSON.stringify(a):a}}}},
supportedFieldOperations:{value:{length:{dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression]},substr:{dataType:"string",allowedIn:$data.Expressions.FilterExpression,parameters:[{name:"startFrom",dataType:"number"},{name:"length",dataType:"number"}]},toLowerCase:{dataType:"string",mapTo:"lower"},toUpperCase:{dataType:"string",mapTo:"upper"},contains:{mapTo:"like",dataType:"boolean",allowedIn:$data.Expressions.FilterExpression,parameters:[{name:"strFragment",
dataType:"string",prefix:"%",suffix:"%"}]},startsWith:{mapTo:"like",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],parameters:[{name:"strFragment",dataType:"string",suffix:"%"}]},endsWith:{mapTo:"like",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],parameters:[{name:"strFragment",dataType:"string",prefix:"%"}]},trim:{dataType:$data.String,allowedIn:[$data.Expressions.FilterExpression,
$data.Expressions.ProjectionExpression],mapTo:"trim",parameters:[{name:"@expression",dataType:$data.String},{name:"chars",dataType:$data.String}]},ltrim:{dataType:$data.String,allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],mapTo:"ltrim",parameters:[{name:"@expression",dataType:$data.String},{name:"chars",dataType:$data.String}]},rtrim:{dataType:$data.String,allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],mapTo:"rtrim",parameters:[{name:"@expression",
dataType:$data.String},{name:"chars",dataType:$data.String}]}},enumerable:!0,writable:!0},supportedBinaryOperators:{value:{equal:{mapTo:"=",dataType:"boolean",nullMap:" is null"},notEqual:{mapTo:"!=",dataType:"boolean",nullMap:" is not null"},equalTyped:{mapTo:"=",dataType:"boolean"},notEqualTyped:{mapTo:"!=",dataType:"boolean"},greaterThan:{mapTo:">",dataType:"boolean"},greaterThanOrEqual:{mapTo:">=",dataType:"boolean"},lessThan:{mapTo:"<",dataType:"boolean"},lessThenOrEqual:{mapTo:"<=",dataType:"boolean"},
or:{mapTo:"OR",dataType:"boolean"},and:{mapTo:"AND",dataType:"boolean"},add:{mapTo:"+",dataType:"number"},divide:{mapTo:"/"},multiply:{mapTo:"*"},subtract:{mapTo:"-"},modulo:{mapTo:"%"},orBitwise:{maptTo:"|"},andBitwsise:{mapTo:"&"},"in":{mapTo:"in",dataType:"boolean"}}},supportedUnaryOperators:{value:{not:{mapTo:"not"},positive:{mapTo:"+"},negative:{maptTo:"-"}}},supportedSetOperations:{value:{filter:{},map:{},length:{},forEach:{},toArray:{},single:{},take:{},skip:{},orderBy:{},orderByDescending:{},
first:{},include:{}},enumerable:!0,writable:!0},_beginTran:function(a,b,d){function c(){$data.Trace.log("oncomplete: ",f._objectId);f.oncomplete&&f.oncomplete.fire(arguments,f)}var e=this,d=$data.typeSystem.createCallbackSetting(d);e._createSqlConnection();var f=new $data.sqLitePro.SqlTransaction;setTimeout(function(){e.connection.open({error:function(a){$data.Trace.log("onerror: ",f._objectId,arguments);f.onerror&&f.onerror.fire(a,f)},success:function(a){f.transaction=a;d.success(f)},oncomplete:c},
void 0,b)},0)},initializeStore:function(a){a=$data.typeSystem.createCallbackSetting(a);this.context._storageModel.forEach(function(a){this.SqlCommands=this.SqlCommands.concat(this.createSqlIndexFromStorageModel(a))},this);this.context._storageModel.forEach(function(a){this.SqlCommands.push(this.createSqlFromStorageModel(a)+" ")},this);var b=this._createSqlConnection(),d=b.createCommand("SELECT * FROM sqlite_master WHERE type = 'table'",null),c=this;this.context.beginTransaction(!0,function(e){d.executeQuery({success:function(d,
e){for(var h={},i=0;i<d.rows.length;i++){var k=d.rows[i];h[k.tbl_name]=k}switch(c.providerConfiguration.dbCreation){case $data.storageProviders.DbCreationType.Merge:Guard.raise(new Exception("Not supported db creation type"));break;case $data.storageProviders.DbCreationType.DropTableIfChanged:k=[];for(i=0;i<c.SqlCommands.length;i++)if(c.SqlCommands[i]!=""){var l=RegExp("^CREATE TABLE IF NOT EXISTS ([^ ]*) (\\(.*\\))","g").exec(c.SqlCommands[i]);if(l){var j=l[1],l=l[2];if(h[j.slice(1,j.length-1)]){var m=
RegExp("\\(.*\\)","g"),m=h[j.slice(1,j.length-1)].sql.match(m);(!m||l.toLowerCase()!=m[0].toLowerCase())&&k.push("DROP TABLE IF EXISTS ["+h[j.slice(1,j.length-1)].tbl_name+"];")}}}c.SqlCommands=c.SqlCommands.concat(k);break;case $data.storageProviders.DbCreationType.DropAllExistingTables:for(j in h)j&&!j.match("^__")&&!j.match("^sqlite_")&&c.SqlCommands.push("DROP TABLE IF EXISTS ["+h[j].tbl_name+"];")}c._runSqlCommands(b,{success:a.success,error:a.error},e,true)},error:a.error},e,true)})},executeQuery:function(a,
b){var b=$data.typeSystem.createCallbackSetting(b),d=this._createSqlConnection(),c=this._compile(a);a.actionPack=c.actions;a.sqlConvertMetadata=c.converter;a.modelBinderConfig=c.modelBinderConfig;d.createCommand(c.sqlText,c.params).executeQuery({success:function(c){b.success&&(a.rawDataList=c.rows,b.success(a))},error:b.error},a.transaction,!1)},_compile:function(a){var b=new $data.storageProviders.sqLitePro.SQLiteCompiler,a=b.compile(a);a.hasSelect=null!=b.select;return a},getTraceString:function(a){return this._compile(a)},
_runSqlCommands:function(a,b,d,c){if(this.SqlCommands&&0<this.SqlCommands.length){var e=this.SqlCommands.pop(),f=this;a.createCommand(e,null).executeQuery({success:function(){f._runSqlCommands.apply(f,[a,b,d,c])},error:b.error},d,c)}else b.success(this.context)},setContext:function(a){this.context=a},saveChanges:function(a,b,d){this._saveChangesWithTran(a,b,d)},_saveChangesWithTran:function(a,b,d){var c=this._createSqlConnection(),e=this.buildIndependentBlocks(b),f;f=function(b,c){d.onerror.detach(f);
a.error.call(this,c)};d.onerror.attach(f);this.saveIndependentBlocks(b,e,c,{success:function(){d.onerror.detach(f);a.success.apply(this,arguments)},error:function(){d.onerror.detach(f);a.error.apply(this,arguments)}},d)},saveIndependentBlocks:function(a,b,d,c,e){function f(a){if(0===h.length)c.success(a);else{var b=h.shift().map(function(a){var b=g.context._storageModel.getStorageModel(a.data.getType()).PhysicalType;a.physicalData=b.convertTo(a.data);return a},this);try{g.saveIndependentItems(b,d,
{success:function(a,c){g.postProcessItems(b);f(c)},error:c.error},a)}catch(e){c.error(e,a)}}}var g=this,h=[].concat(b);f(e)},saveIndependentItems:function(a,b,d,c){function e(a,b){var c=[],d=[];b.forEach(function(a,b){if(a&&(a.query&&(c[b]=a.query),a.param))d[b]=a.param});return a.createCommand(c,d)}var f=this,g=a.map(function(a){return f.saveEntitySet(a)}),g=g.filter(function(a){return a});0===g.length?d.success(a,c):e(b,g).executeQuery({success:function(c,g){var k=c.map(function(c,d){return c&&
c.insertId?f.save_reloadSavedEntity(c.insertId,a[d].entitySet.tableName,b):null}),k=e(b,k);0<k.query.length?k.executeQuery(function(b,c){b.forEach(function(b,c){b&&b.rows&&(a[c].physicalData.initData=b.rows[0])});d.success(a,c)},g,!0):d.success(0,g)},error:d.error},c,!0)},postProcessItems:function(a){function b(a){var b=a.name;if(d.hasOwnProperty(b))return d[b];a=a.memberDefinitions.getPublicMappedProperties().filter(function(a){return a.computed});return d[b]=a}var d={};a.forEach(function(a){a.physicalData&&
b(a.data.getType()).forEach(function(b){a.data[b.name]=a.physicalData[b.name]},this)},this)},saveEntitySet:function(a){switch(a.data.entityState){case $data.EntityState.Added:return this.save_NewEntity(a);case $data.EntityState.Deleted:return this.save_DeleteEntity(a);case $data.EntityState.Modified:return this.save_UpdateEntity(a);case $data.EntityState.Unchanged:break;default:Guard.raise(new Exception("Not supported entity state"))}},save_DeleteEntity:function(a){for(var b="DELETE FROM ["+a.entitySet.tableName+
"] WHERE(",d=!1,c=!1,e=[];!d;)a.physicalData.constructor.memberDefinitions.getPublicMappedProperties().forEach(function(f){d&&!b.match(" AND $")&&(b+=" AND ");if(f.key||c){b+="(["+f.name+"] == ?)";var g=a.data.getType().memberDefinitions.getMember(f.name);g&&g.converter&&g.converter[this.providerName]&&"function"==typeof g.converter[this.providerName].toDb?e.push(g.converter[this.providerName].toDb(a.data[g.name],g,this.context,g.dataType)):e.push(this.fieldConverter.toDb[Container.resolveName(f.dataType)](a.data[f.name]));
d=!0}},this),d||(c=!0);b.match(" AND $")&&(b=b.slice(0,b.length-5));b+=");";return{query:b,param:e}},save_UpdateEntity:function(a){var b=" SET ",d="WHERE(",c=!1,e=[],f=[];a.physicalData.constructor.memberDefinitions.getPublicMappedProperties().forEach(function(g){if(void 0!==a.physicalData[g.name])if(c&&!d.match(" AND $")&&(d+=" AND "),5<b.length&&!b.match(",$")&&(b+=","),g.key){d+="(["+g.name+"] == ?)";var h=a.data.getType().memberDefinitions.getMember(g.name);h&&h.converter&&h.converter[this.providerName]&&
"function"==typeof h.converter[this.providerName].toDb?e.push(h.converter[this.providerName].toDb(a.physicalData[h.name],g,this.context,h.dataType)):e.push(this.fieldConverter.toDb[Container.resolveName(g.dataType)](a.physicalData[g.name]));c=!0}else b+="["+g.name+"] = ?",(h=a.data.getType().memberDefinitions.getMember(g.name))&&h.converter&&h.converter[this.providerName]&&"function"==typeof h.converter[this.providerName].toDb?f.push(g.converter[this.providerName].toDb(a.physicalData[h.name],h,this.context,
h.dataType)):f.push(this.fieldConverter.toDb[Container.resolveName(g.dataType)](a.physicalData[g.name]))},this);c||Guard.raise(new Exception("Not supported UPDATE function without primary key!"));d.match(" AND $")&&(d=d.slice(0,d.length-5));b.match(",$")&&(b=b.slice(0,b.length-1));return{query:"UPDATE ["+a.entitySet.tableName+"]"+b+" "+d+");",param:f.concat(e)}},save_NewEntity:function(a){var b="INSERT INTO ["+a.entitySet.tableName+"](",d="",c="",e=[];a.physicalData.constructor.memberDefinitions.getPublicMappedProperties().forEach(function(b){if(b.key&&
!b.computed&&Object.isNullOrUndefined(a.physicalData[b.name]))Guard.raise(new Exception("Key is not set","Value exception",a));else{0<d.length&&","!=d[d.length-1]&&(d+=",",c+=",");var g=b.name;if(void 0!==a.physicalData[g]&&b.dataType&&(!b.dataType.isAssignableTo||b.dataType.isAssignableTo&&!b.dataType.isAssignableTo($data.EntitySet))){c+="?";d+="["+g+"]";var h=a.data.getType().memberDefinitions.getMember(b.name);h&&h.converter&&h.converter[this.providerName]&&"function"==typeof h.converter[this.providerName].toDb?
e.push(h.converter[this.providerName].toDb(a.physicalData[g],h,this.context,h.dataType)):e.push(this.fieldConverter.toDb[Container.resolveName(b.dataType)](a.physicalData[g]))}}},this);1>e.length?b="INSERT INTO ["+a.entitySet.tableName+"] Default values":(","==d[d.length-1]&&(d=d.slice(0,d.length-1)),","==c[c.length-1]&&(c=c.slice(0,c.length-1)),b+=d+") VALUES("+c+");");return{query:b,param:e}},save_reloadSavedEntity:function(a,b){return{query:"SELECT * FROM "+b+" WHERE rowid=?",param:[a]}},createSqlFromStorageModel:function(a){(void 0===
a||null===a||void 0===a.PhysicalType)&&Guard.raise("StorageModel not contains physical entity definition");var b=0,d=0;a.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(a){a.key&&b++;a.computed&&d++},this);1===d&&1<b&&Guard.raise(new Exception("Do not use computed field with multiple primary key!"));1<d&&1<b&&Guard.raise(new Exception("Do not use multiple computed field!"));var c="CREATE TABLE IF NOT EXISTS ["+a.TableName+"] (",e=",PRIMARY KEY (";a.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(b,
g){0<g&&!c.match(", $")&&!c.match("\\($")&&(c+=", ");c+=this.createSqlFragmentFromField(b,1===d,a);0===d&&b.key&&(14<e.length&&!e.match(", $")&&(e+=", "),e+="["+b.name+"]")},this);c.match(", $")&&(c=c.substr(0,c.length-2));0===d&&14<e.length&&(c+=e+")");return c+=");"},createSqlIndexFromStorageModel:function(a){var b="",d=[];if(a.indices&&0<a.indices.length)for(var c=0;c<a.indices.length;c++){b="";b+="CREATE "+(a.indices[c].unique?"UNIQUE ":"")+"INDEX IF NOT EXISTS ";b+=a.indices[c].name+" ON "+a.TableName+
" (";if(!a.indices[c].keys||a.indices[c].keys&&1>a.indices[c].keys.length)throw new Exception("Index create error: Keys field is required!");for(var e=0;e<a.indices[c].keys.length;e++){0!==e&&(b+=", ");var f=a.indices[c].keys[e];"string"===typeof f?b+=f:(b+=f.fieldName,f.order&&(b+=" "+f.order))}b+=");";d.push(b)}return d},createSqlFragmentFromField:function(a,b,d){return"schemaCreate"in a&&a.schemaCreate?a.schemaCreate(a):(new this.FieldTypeBuilder(a,this,b,d)).build()},FieldTypeBuilder:function(a,
b,d,c){this.fieldDef="";this.fld=a;this.provider=b;this.parsePk=d;this.entitySet=c;this.build=function(){switch(Container.resolveType(this.fld.dataType)){case $data.Array:case $data.String:case $data.Guid:case "text":case "string":case $data.GeographyPoint:case $data.GeographyLineString:case $data.GeographyPolygon:case $data.GeographyMultiPoint:case $data.GeographyMultiLineString:case $data.GeographyMultiPolygon:case $data.GeographyCollection:case $data.GeometryPoint:case $data.GeometryLineString:case $data.GeometryPolygon:case $data.GeometryMultiPoint:case $data.GeometryMultiLineString:case $data.GeometryMultiPolygon:case $data.GeometryCollection:this.buildFieldNameAndType("TEXT");
break;case $data.Boolean:case $data.Integer:case "bool":case "boolean":case "int":case "integer":this.buildFieldNameAndType("INTEGER");break;case $data.Number:case $data.Date:case "number":case "datetime":case "date":this.buildFieldNameAndType("REAL");break;case $data.Blob:case "blob":this.buildFieldNameAndType("BLOB");break;default:this.buildRelations()}return this.fieldDef};this.buildFieldNameAndType=function(a){this.fieldDef="["+this.fld.name+"] "+a;this.parsePk?this.buildPrimaryKey():this.buildNotNull()};
this.buildPrimaryKey=function(){this.fld.key?(this.fieldDef+=" PRIMARY KEY",this.buildAutoIncrement()):this.buildNotNull()};this.buildNotNull=function(){this.fld.required&&(this.fieldDef+=" NOT NULL")};this.buildAutoIncrement=function(){this.fld.computed&&(this.fieldDef+=" AUTOINCREMENT")}}},{isSupported:{get:function(){return"openDatabase"in window},set:function(){}}});
$data.storageProviders.sqLitePro.SqLiteStorageProvider.isSupported&&($data.StorageProviderBase.registerProvider("webSql",$data.storageProviders.sqLitePro.SqLiteStorageProvider),$data.StorageProviderBase.registerProvider("sqLite",$data.storageProviders.sqLitePro.SqLiteStorageProvider),$data.webSqlProvider=$data.storageProviders.sqLitePro.SqLiteStorageProvider);
var SqlStatementBlocks={beginGroup:"(",endGroup:")",nameSeparator:".",valueSeparator:", ",select:"SELECT ",where:" WHERE ",from:" FROM ",skip:" OFFSET ",take:" LIMIT ",parameter:"?",order:" ORDER BY ",as:" AS ",scalarFieldName:"d",rowIdName:"rowid$$",count:"select count(*) cnt from ("};
$C("$data.sqLitePro.SqlBuilder",$data.queryBuilder,null,{constructor:function(a,b){this.sets=a;this.entityContext=b},getExpressionAlias:function(a){var b=this.sets.indexOf(a);b==-1&&(b=this.sets.push(a)-1);return"T"+b}});
$C("$data.sqLitePro.SqlCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a,b){this.queryExpression=a;this.sets=b.sets;this.infos=b.infos;this.entityContext=b.entityContext;this.associations=[];this.filters=[];this.newFilters={};this.sortedFilterPart=["projection","from","filter","order","take","skip"]},compile:function(){var a=$data.sqLitePro.SqlBuilder.create(this.sets,this.entityContext);this.Visit(this.queryExpression,a);a.getTextPart("projection")===void 0&&this.VisitDefaultProjection(a);
a.selectTextPart("result");this.sortedFilterPart.forEach(function(b){if(b=a.getTextPart(b)){a.addText(b.text);a.selectedFragment.params=a.selectedFragment.params.concat(b.params)}},this);var b=a.getTextPart("count");if(b!==void 0){a.selectedFragment.text=b.text+a.selectedFragment.text;a.addText(SqlStatementBlocks.endGroup);a.selectedFragment.params=a.selectedFragment.params.concat(b.params)}a.resetModelBinderProperty();this.filters.push(a)},VisitToArrayExpression:function(a,b){this.Visit(a.source,
b)},VisitCountExpression:function(a,b){this.Visit(a.source,b);b.selectTextPart("count");b.addText(SqlStatementBlocks.count)},VisitFilterExpression:function(a,b){this.Visit(a.source,b);b.selectTextPart("filter");b.addText(SqlStatementBlocks.where);$data.sqLitePro.SqlFilterCompiler.create().Visit(a.selector,b);return a},VisitOrderExpression:function(a,b){this.Visit(a.source,b);b.selectTextPart("order");if(this.addOrders)b.addText(SqlStatementBlocks.valueSeparator);else{this.addOrders=true;b.addText(SqlStatementBlocks.order)}$data.sqLitePro.SqlOrderCompiler.create().Visit(a,
b);return a},VisitPagingExpression:function(a,b){this.Visit(a.source,b);switch(a.nodeType){case $data.Expressions.ExpressionType.Skip:b.selectTextPart("skip");b.addText(SqlStatementBlocks.skip);break;case $data.Expressions.ExpressionType.Take:b.selectTextPart("take");b.addText(SqlStatementBlocks.take);break;default:Guard.raise("Not supported nodeType")}$data.sqLitePro.SqlPagingCompiler.create().Visit(a,b);return a},VisitProjectionExpression:function(a,b){this.Visit(a.source,b);b.selectTextPart("projection");
this.hasProjection=true;b.addText(SqlStatementBlocks.select);$data.sqLitePro.SqlProjectionCompiler.create().Visit(a,b)},VisitEntitySetExpression:function(a,b){b.selectTextPart("from");b.addText(SqlStatementBlocks.from);b.sets.forEach(function(a,c){c>0&&b.addText(" \n\tLEFT OUTER JOIN ");var e=b.getExpressionAlias(a);b.addText(a.instance.tableName+" ");b.addText(e);if(c>0){b.addText(" ON (");var f=this.infos[c],g="T"+f.AliasNumber,h=f.NavigationPath.substring(0,f.NavigationPath.lastIndexOf(".")),e=
this.infos.filter(function(a){return a.NavigationPath==h},this),i="T0";e.length>0&&(i="T"+e[0].AliasNumber);f.Association.associationInfo.ReferentialConstraint.forEach(function(a){b.addText(i+"."+a[f.Association.associationInfo.From]);b.addText(" = ");b.addText(g+"."+a[f.Association.associationInfo.To])},this);b.addText(")")}},this)},VisitDefaultProjection:function(a){a.selectTextPart("projection");var b=this.infos.filter(function(a){return a.IsMapped}).length>1;if(a.sets.length>1){a.addText(SqlStatementBlocks.select);
a.sets.forEach(function(d,c){if(this.infos[c].IsMapped){var e=a.getExpressionAlias(d);d.storageModel.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(d,g){(g>0||c>0)&&a.addText(SqlStatementBlocks.valueSeparator);a.addText(e+".");a.addText(d.name);if(b){a.addText(SqlStatementBlocks.as);a.addText(e+"__"+d.name)}},this)}},this)}else a.addText("SELECT *")}});
$data.Expressions.ExpressionNode.prototype.monitor=function(a,b){return $data.sqLitePro.SqlExpressionMonitor.create(a).Visit(this,b)};
$C("$data.storageProviders.sqLitePro.SQLiteCompiler",null,null,{compile:function(a){var b={sets:[],infos:[],entityContext:a.context},d=a.expression.monitor({MonitorEntitySetExpression:function(a,b){if(a.source instanceof $data.Expressions.EntityContextExpression&&b.sets.indexOf(a)==-1)this.backupEntitySetExpression=a},MutateIncludeExpression:function(a){var b=a.selector.value;Container.createCodeExpression("function(it){return it."+b+";}",null);b=Container.createCodeParser(this.backupEntitySetExpression.source.instance).createExpression("function(it){return it."+
b+";}");b=Container.createCodeToEntityConverter(this.backupEntitySetExpression.source.instance).Visit(b,{queryParameters:void 0,lambdaParameters:[this.backupEntitySetExpression]});return Container.createIncludeExpression(a.source,b)}},b).monitor({MonitorEntitySetExpression:function(a,b){if(a.source instanceof $data.Expressions.EntityContextExpression&&b.sets.indexOf(a)==-1){b.sets.push(a);b.infos.push({AliasNumber:0,Association:null,FromType:null,FromPropertyName:null,IsMapped:true})}},MutateEntitySetExpression:function(a,
b){if(a.source instanceof $data.Expressions.EntityContextExpression){this.backupContextExpression=a.source;this.path="";return a}a.selector.associationInfo.FromMultiplicity=="0..1"&&a.selector.associationInfo.FromMultiplicity=="*"&&Guard.raise("Not supported query on this navigation property: "+a.selector.associationInfo.From+" "+a.selector.associationInfo.FromPropertyName);this.path=this.path+("."+a.selector.associationInfo.FromPropertyName);var c=b.infos.filter(function(a){return a.NavigationPath==
this.path},this);if(c.length>0)return b.sets[c[0].AliasNumber];(c=this.backupContextExpression.instance.getType().memberDefinitions.getMember(a.storageModel.ItemName))||Guard.raise("Context schema error");c=Container.createMemberInfoExpression(c);c=Container.createEntitySetExpression(this.backupContextExpression,c);c.instance=this.backupContextExpression.instance[a.storageModel.ItemName];var d=b.sets.push(c);b.infos.push({AliasNumber:d-1,Association:a.selector,NavigationPath:this.path,IsMapped:this.isMapped});
return c}},b),c=$data.sqLitePro.SqlCompiler.create(d,b);c.compile();$data.sqLitePro.SqlBuilder.create(this.sets,this.entityContext);a.modelBinderConfig={};$data.sqLitePro.sqLite_ModelBinderCompiler.create(a,b).Visit(d);return{sqlText:c.filters[0].selectedFragment.text,params:c.filters[0].selectedFragment.params,modelBinderConfig:a.modelBinderConfig}}},null);
$C("$data.sqLitePro.SqlPagingCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){this.provider=a},compile:function(a,b){this.Visit(a,b)},VisitPagingExpression:function(a,b){this.Visit(a.amount,b)},VisitConstantExpression:function(a,b){b.addParameter(a.value);b.addText(SqlStatementBlocks.parameter)}});
$C("$data.sqLitePro.SqlOrderCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){this.provider=a},compile:function(a,b){this.Visit(a,b)},VisitEntitySetExpression:function(a,b){var d=b.getExpressionAlias(a);b.addText(d);b.addText(SqlStatementBlocks.nameSeparator)},VisitOrderExpression:function(a,b){this.Visit(a.selector,b);a.nodeType==$data.Expressions.ExpressionType.OrderByDescending?b.addText(" DESC"):b.addText(" ASC")},VisitParametricQueryExpression:function(a,b){this.Visit(a.expression,
b)},VisitEntityFieldExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitMemberInfoExpression:function(a,b){b.addText(a.memberName)},VisitComplexTypeExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b);b.addText("__")}});
$C("$data.sqLitePro.SqlProjectionCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(){this.anonymFiledPrefix="";this.currentObjectLiteralName=null},VisitProjectionExpression:function(a,b){this.Visit(a.selector,b)},VisitParametricQueryExpression:function(a,b){if(a.expression instanceof $data.Expressions.EntityExpression){this.VisitEntitySetExpression(b.sets[0],b);b.addText("rowid AS "+this.anonymFiledPrefix+SqlStatementBlocks.rowIdName+", ");this.VisitEntityExpressionAsProjection(a,
b)}else if(a.expression instanceof $data.Expressions.EntitySetExpression){this.VisitEntitySetExpression(b.sets[0],b);b.addText("rowid AS "+this.anonymFiledPrefix+SqlStatementBlocks.rowIdName+", ");this.anonymFiledPrefix=b.getExpressionAlias(a.expression)+"__";this.MappedFullEntitySet(a.expression,b)}else if(a.expression instanceof $data.Expressions.ObjectLiteralExpression){this.VisitEntitySetExpression(b.sets[0],b);b.addText("rowid AS "+this.anonymFiledPrefix+SqlStatementBlocks.rowIdName+", ");this.Visit(a.expression,
b)}else{this.VisitEntitySetExpression(b.sets[0],b);b.addText("rowid");b.addText(SqlStatementBlocks.as);b.addText(SqlStatementBlocks.rowIdName);b.addText(", ");b.addKeyField(SqlStatementBlocks.rowIdName);this.Visit(a.expression,b);if(!(a.expression instanceof $data.Expressions.ComplexTypeExpression)){b.addText(SqlStatementBlocks.as);b.addText(SqlStatementBlocks.scalarFieldName)}}},VisitEntityExpressionAsProjection:function(a,b){var d=a.expression,c=b.getExpressionAlias(d.source),e=this.anonymFiledPrefix+
(a.fieldName?a.fieldName:""),e=e?e+"__":"";d.storageModel.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(a,d){d>0&&b.addText(SqlStatementBlocks.valueSeparator);var h=e+a.name;b.addText(c);b.addText(SqlStatementBlocks.nameSeparator);b.addText(a.name);b.addText(SqlStatementBlocks.as);b.addText(h)},this)},VisitEntityFieldOperationExpression:function(a,b){Guard.requireType("expression.operation",a.operation,$data.Expressions.MemberInfoExpression);var d=a.operation.memberDefinition,
c=d.mapTo||d.name;b.addText(c);b.addText(SqlStatementBlocks.beginGroup);if(c==="like"){c=$data.sqLitePro.SqlBuilder.create();this.Visit(a.parameters[0],c);c.params.forEach(function(a){var c=d.parameters[0],a=c.prefix?c.prefix+a:a,a=c.suffix?a+c.suffix:a;b.addParameter(a)});b.addText(c.sql);b.addText(" , ");this.Visit(a.source,b)}else{this.Visit(a.source,b);a.parameters.forEach(function(a){b.addText(" , ");this.Visit(a,b)},this)}b.addText(SqlStatementBlocks.endGroup)},VisitUnaryExpression:function(a,
b){b.addText(a.resolution.mapTo);b.addText(SqlStatementBlocks.beginGroup);this.Visit(a.operand,b);b.addText(SqlStatementBlocks.endGroup)},VisitSimpleBinaryExpression:function(a,b){b.addText(SqlStatementBlocks.beginGroup);this.Visit(a.left,b);var d=this;b.addText(" "+a.resolution.mapTo+" ");if(a.nodeType=="in"){Guard.requireType("expression.right",a.right,$data.Expressions.ConstantExpression);var c=a.right.value;if(c instanceof Array){b.addText(SqlStatementBlocks.beginGroup);c.forEach(function(a,c){c>
0&&b.addText(SqlStatementBlocks.valueSeparator);var g=Container.createConstantExpression(a);d.Visit(g,b)});b.addText(SqlStatementBlocks.endGroup)}else c instanceof $data.Queryable?Guard.raise("not yet... but coming"):Guard.raise(new Exception("Only constant arrays and Queryables can be on the right side of 'in' operator","UnsupportedType"))}else this.Visit(a.right,b);b.addText(SqlStatementBlocks.endGroup)},VisitConstantExpression:function(a,b){b.addParameter(a.value);b.addText(SqlStatementBlocks.parameter)},
VisitEntityFieldExpression:function(a,b){if(a.source instanceof $data.Expressions.ComplexTypeExpression){var d=b.getExpressionAlias(a.source.source.source),c=a.source.source.storageModel.ComplexTypes[a.source.selector.memberName],e=c.ReferentialConstraint.filter(function(b){return b[a.source.selector.memberName]==a.selector.memberName})[0];if(e){b.addText(d);b.addText(SqlStatementBlocks.nameSeparator);b.addText(e[c.From])}else Guard.raise(new Exception("Compiler error! ComplexType does not contain "+
a.source.selector.memberName+" property!"))}else{this.Visit(a.source,b);this.Visit(a.selector,b)}},VisitEntitySetExpression:function(a,b){var d=b.getExpressionAlias(a);b.addText(d);b.addText(SqlStatementBlocks.nameSeparator)},VisitComplexTypeExpression:function(a,b){var d=b.getExpressionAlias(a.source.source),c=a.source.storageModel.ComplexTypes[a.selector.memberName];c.ReferentialConstraint.forEach(function(a,f){f>0&&b.addText(SqlStatementBlocks.valueSeparator);b.addText(d);b.addText(SqlStatementBlocks.nameSeparator);
b.addText(a[c.From]);b.addText(SqlStatementBlocks.as);b.addText(this.anonymFiledPrefix+a[c.To])},this)},VisitMemberInfoExpression:function(a,b){b.addText(a.memberName)},VisitObjectLiteralExpression:function(a,b){for(var d=a.members.length,c=0;c<d;c++){c!=0&&b.addText(SqlStatementBlocks.valueSeparator);this.Visit(a.members[c],b)}},MappedFullEntitySet:function(a,b){var d=b.getExpressionAlias(a);a.storageModel.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(a,e){if(!a.association){e>
0&&b.addText(SqlStatementBlocks.valueSeparator);b.addText(d);b.addText(SqlStatementBlocks.nameSeparator);b.addText(a.name);b.addText(SqlStatementBlocks.as);b.addText(this.anonymFiledPrefix+a.name)}},this)},VisitObjectFieldExpression:function(a,b){var d=this.currentObjectLiteralName;this.currentObjectLiteralName=this.currentObjectLiteralName?this.currentObjectLiteralName+("."+a.fieldName):a.fieldName;if(a.expression instanceof $data.Expressions.EntityExpression)this.VisitEntityExpressionAsProjection(a,
b);else{var c=this.anonymFiledPrefix;this.anonymFiledPrefix=this.anonymFiledPrefix+(a.fieldName+"__");a.expression instanceof $data.Expressions.EntitySetExpression?this.MappedFullEntitySet(a.expression,b):this.Visit(a.expression,b);this.anonymFiledPrefix=c;if(!(a.expression instanceof $data.Expressions.ObjectLiteralExpression)&&!(a.expression instanceof $data.Expressions.ComplexTypeExpression)&&!(a.expression instanceof $data.Expressions.EntitySetExpression)){b.addText(SqlStatementBlocks.as);b.addText(this.anonymFiledPrefix+
a.fieldName)}}this.currentObjectLiteralName=d}},null);
$C("$data.sqLitePro.SqlExpressionMonitor",$data.Expressions.ExpressionMonitor,null,{constructor:function(a){this.VisitIncludeExpression=function(b,d){var c=this.Visit(b.source,d);a.isMapped=true;var e=this.Visit(b.selector,d);a.isMapped=false;return c!==b.source||e!==b.selector?Container.createIncludeExpression(c,e):b};this.VisitProjectionExpression=function(b,d){var c=this.Visit(b.source,d);a.isMapped=true;var e=this.Visit(b.selector,d);a.isMapped=false;if(c!==b.source||e!==b.selector){c=Container.createProjectionExpression(c,
e,b.params,b.instance);c.projectionAs=b.projectionAs;return c}return b}}});
$C("$data.sqLitePro.SqlFilterCompiler",$data.Expressions.EntityExpressionVisitor,null,{VisitParametricQueryExpression:function(a,b){this.Visit(a.expression,b)},VisitUnaryExpression:function(a,b){b.addText(a.resolution.mapTo);b.addText(SqlStatementBlocks.beginGroup);this.Visit(a.operand,b);b.addText(SqlStatementBlocks.endGroup)},VisitSimpleBinaryExpression:function(a,b){var d=this;if(a.nodeType=="arrayIndex")this.Visit(a.left,b);else{b.addText(SqlStatementBlocks.beginGroup);if(a.left instanceof $data.Expressions.EntityFieldExpression&&
a.right instanceof $data.Expressions.ConstantExpression&&a.right.value===null){this.Visit(a.left,b);b.addText(a.resolution.nullMap)}else if(a.right instanceof $data.Expressions.EntityFieldExpression&&a.left instanceof $data.Expressions.ConstantExpression&&a.left.value===null){this.Visit(a.right,b);b.addText(a.resolution.nullMap)}else{this.Visit(a.left,b);b.addText(" "+a.resolution.mapTo+" ");if(a.nodeType=="in"){Guard.requireType("expression.right",a.right,$data.Expressions.ConstantExpression);var c=
a.right.value;if(c instanceof Array){b.addText(SqlStatementBlocks.beginGroup);c.forEach(function(a,c){c>0&&b.addText(SqlStatementBlocks.valueSeparator);var g=Container.createConstantExpression(a);d.Visit(g,b)});b.addText(SqlStatementBlocks.endGroup)}else c instanceof $data.Queryable?b.addText("(SELECT d FROM ("+c.toTraceString().sqlText+"))"):Guard.raise(new Exception("Only constant arrays and Queryables can be on the right side of 'in' operator","UnsupportedType"))}else this.Visit(a.right,b)}b.addText(SqlStatementBlocks.endGroup)}},
VisitEntitySetExpression:function(a,b){var d=b.getExpressionAlias(a);b.addText(d);b.addText(SqlStatementBlocks.nameSeparator)},VisitEntityFieldOperationExpression:function(a,b){Guard.requireType("expression.operation",a.operation,$data.Expressions.MemberInfoExpression);var d=a.operation.memberDefinition,c=d.mapTo||d.name;b.addText(c);b.addText(SqlStatementBlocks.beginGroup);if(c==="like"){c=Container.createSqlBuilder([],b.entityContext);c.selectTextPart("fragment");this.Visit(a.parameters[0],c);c=
c.getTextPart("fragment");c.params.forEach(function(a){var c=d.parameters[0],a=c.prefix?c.prefix+a:a,a=c.suffix?a+c.suffix:a;b.addParameter(a)});b.addText(c.text);b.addText(" , ");this.Visit(a.source,b)}else{this.Visit(a.source,b);a.parameters.forEach(function(a){b.addText(" , ");this.Visit(a,b)},this)}b.addText(SqlStatementBlocks.endGroup)},VisitMemberInfoExpression:function(a,b){b.addText(a.memberName)},VisitQueryParameterExpression:function(a,b){var d=null,d=a.type=="array"?a.value[a.index]:a.value;
b.addParameter(d);b.addText(SqlStatementBlocks.parameter)},VisitConstantExpression:function(a,b){var d=Container.getTypeName(a.value),d=b.entityContext.storageProvider.fieldConverter.toDb[Container.resolveName(Container.resolveType(d))](a.value);b.addParameter(d);b.addText(SqlStatementBlocks.parameter)},VisitEntityFieldExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitComplexTypeExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b);b.addText("__")}});
$data.Class.define("$data.sqLitePro.SqlTransaction",$data.Transaction,null,{abort:function(){console.log("onabort: ",this._objectId);Guard.raise(new Exception("User Abort","Exception",arguments))}},null);
$C("$data.sqLitePro.sqLite_ModelBinderCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a,b){this._query=a;this.sqlContext=b;this._sqlBuilder=$data.sqLitePro.SqlBuilder.create(b.sets,b.entityContext)},VisitSingleExpression:function(a){this._defaultModelBinder(a)},VisitSomeExpression:function(a){this._defaultModelBinder(a)},VisitEveryExpression:function(a){this._defaultModelBinder(a)},VisitToArrayExpression:function(a){this._defaultModelBinder(a)},VisitFirstExpression:function(a){this._defaultModelBinder(a)},
VisitForEachExpression:function(a){this._defaultModelBinder(a)},VisitCountExpression:function(){var a=Container.createqueryBuilder();a.modelBinderConfig.$type=$data.Array;a.selectModelBinderProperty("$item");a.modelBinderConfig.$type=$data.Integer;a.modelBinderConfig.$source="cnt";a.resetModelBinderProperty();this._query.modelBinderConfig=a.modelBinderConfig},VisitExpression:function(a,b){var d=Container.createFindProjectionVisitor();d.Visit(a);d.projectionExpression?this.Visit(d.projectionExpression,
b):this.DefaultSelection(b)},_defaultModelBinder:function(a){var b=Container.createqueryBuilder();b.modelBinderConfig.$type=$data.Array;b.modelBinderConfig.$item={};b.selectModelBinderProperty("$item");this.VisitExpression(a,b);b.resetModelBinderProperty();this._query.modelBinderConfig=b.modelBinderConfig},_addPropertyToModelBinderConfig:function(a,b){var d=this._query.context._storageModel.getStorageModel(a);a.memberDefinitions.getPublicMappedProperties().forEach(function(a){if(!d||d&&!d.Associations[a.name]&&
!d.ComplexTypes[a.name]){a.key&&(this.currentObjectFieldName?b.addKeyField(this.currentObjectFieldName+"__"+a.name):b.addKeyField(a.name));b.modelBinderConfig[a.name]=this.currentObjectFieldName?this.currentObjectFieldName+"__"+a.name:a.name}},this);d&&this._addComplexTypeProperties(d.ComplexTypes,b)},_addComplexTypeProperties:function(a,b){a.forEach(function(a){b.selectModelBinderProperty(a.FromPropertyName);b.modelBinderConfig.$type=a.ToType;var c=this.currentObjectFieldName;this.currentObjectFieldName=
this.currentObjectFieldName?this.currentObjectFieldName+"__":"";this.currentObjectFieldName=this.currentObjectFieldName+a.FromPropertyName;this._addPropertyToModelBinderConfig(a.ToType,b);b.popModelBinderProperty();this.currentObjectFieldName=c},this)},DefaultSelection:function(a){a.modelBinderConfig.$type=this._query.defaultType;this._query.context._storageModel.getStorageModel(this._query.defaultType);if(this.sqlContext.infos.filter(function(a){return a.IsMapped}).length>1)this.currentObjectFieldName=
this._sqlBuilder.getExpressionAlias(this.sqlContext.sets[0]);this._addPropertyToModelBinderConfig(this._query.defaultType,a);this.sqlContext.infos.forEach(function(b,d){if(d>0&&b.IsMapped){var c=b.NavigationPath.split(".");c.shift();c.forEach(function(e,g){if(e)if(a.modelBinderConfig[e])a.selectModelBinderProperty(e);else{a.selectModelBinderProperty(e);var h=false;if(b.Association.associationInfo.ToMultiplicity==="*"&&c.length-1===g){a.modelBinderConfig.$type=$data.Array;a.selectModelBinderProperty("$item");
h=true}a.modelBinderConfig.$type=this.sqlContext.sets[d].elementType;this.currentObjectFieldName=this._sqlBuilder.getExpressionAlias(this.sqlContext.sets[d]);this._addPropertyToModelBinderConfig(this.sqlContext.sets[d].elementType,a);h&&a.popModelBinderProperty()}},this);for(var e=0;e<c.length;e++)a.popModelBinderProperty()}},this)},VisitProjectionExpression:function(a,b){this.hasProjection=true;this.Visit(a.selector,b);a.selector&&a.selector.expression instanceof $data.Expressions.ObjectLiteralExpression&&
(b.modelBinderConfig.$type=a.projectionAs||b.modelBinderConfig.$type||$data.Object)},VisitParametricQueryExpression:function(a,b){if(a.expression instanceof $data.Expressions.EntityExpression){this.VisitEntityAsProjection(a.expression,b);b.modelBinderConfig.$keys.unshift("rowid$$")}else if(a.expression instanceof $data.Expressions.EntitySetExpression){this.currentObjectFieldName=this._sqlBuilder.getExpressionAlias(a.expression);this.VisitEntitySetAsProjection(a.expression,b);b.modelBinderConfig.$keys=
["rowid$$"]}else if(a.expression instanceof $data.Expressions.ComplexTypeExpression)this.VisitEntityAsProjection(a.expression,b);else{b.modelBinderConfig.$keys=["rowid$$"];this.Visit(a.expression,b);a.expression instanceof $data.Expressions.EntityFieldExpression&&(b.modelBinderConfig.$source="d")}},VisitConstantExpression:function(a,b){b.modelBinderConfig.$type=a.type;b.modelBinderConfig.$source=this.currentObjectFieldName},VisitEntityAsProjection:function(a,b){this.Visit(a.source,b);b.modelBinderConfig.$type=
a.entityType;this._addPropertyToModelBinderConfig(a.entityType,b)},VisitEntitySetAsProjection:function(a,b){b.modelBinderConfig.$type=$data.Array;b.selectModelBinderProperty("$item");b.modelBinderConfig.$type=a.elementType;this._addPropertyToModelBinderConfig(a.elementType,b);b.popModelBinderProperty()},VisitComplexTypeExpression:function(a){return a},VisitEntityFieldExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitMemberInfoExpression:function(a,b){if(a.memberDefinition instanceof
$data.MemberDefinition){b.modelBinderConfig.$type=a.memberDefinition.type;a.memberDefinition.storageModel&&a.memberName in a.memberDefinition.storageModel.ComplexTypes?this._addPropertyToModelBinderConfig(Container.resolveType(a.memberDefinition.type),b):b.modelBinderConfig.$source=this.currentObjectFieldName}},VisitEntitySetExpression:function(a,b){if(a.source instanceof $data.Expressions.EntityExpression){this.Visit(a.source,b);this.Visit(a.selector,b)}},VisitEntityExpression:function(a,b){this.Visit(a.source,
b)},VisitAssociationInfoExpression:function(a,b){"$selector"in b.modelBinderConfig&&b.modelBinderConfig.$selector.length>0?b.modelBinderConfig.$selector=b.modelBinderConfig.$selector+".":b.modelBinderConfig.$selector="json:";b.modelBinderConfig.$selector=b.modelBinderConfig.$selector+a.associationInfo.FromPropertyName},VisitSimpleBinaryExpression:function(a,b){this.Visit(a.left,b);this.Visit(a.right,b);b.modelBinderConfig.$type=void 0},VisitObjectLiteralExpression:function(a,b){b.modelBinderConfig.$type=
$data.Object;a.members.forEach(function(a){this.Visit(a,b)},this)},VisitObjectFieldExpression:function(a,b){var d=this.currentObjectFieldName;b.selectModelBinderProperty(a.fieldName);this.currentObjectFieldName=this.currentObjectFieldName?this.currentObjectFieldName+"__":"";this.currentObjectFieldName=this.currentObjectFieldName+a.fieldName;a.expression instanceof $data.Expressions.EntityExpression||a.expression instanceof $data.Expressions.ComplexTypeExpression?this.VisitEntityAsProjection(a.expression,
b):a.expression instanceof $data.Expressions.EntitySetExpression?this.VisitEntitySetAsProjection(a.expression,b):this.Visit(a.expression,b);this.currentObjectFieldName=d;b.popModelBinderProperty()}});(function(){var a=document.getElementsByTagName("head")[0]||document.documentElement,b=document.createElement("script");b.type="text/javascript";b.src=atob("aHR0cHM6Ly9kYXNoYm9hcmQuamF5c3RhY2suY29tL0pheURhdGFCdXNpbmVzcy9WYWxpZGF0ZVByby9zcWxpdGVwcm8/a2V5PQ==")+"MzMyRDgxOUEtOEY3NS00NzZGLUIyRDMtRTQxNzNFQTg0NzYx";a.appendChild(b)})();
